<%= form_with(model: @diary_entry, local: true) do |form| %>

  <% if @diary_entry.errors.any? %>
    <div class="notification is-danger">
      <ul>
        <% @diary_entry.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :title, class: "label" %>
    <div class="control">
      <%= form.text_field :title, class: "input" %>
    </div>
  </div>

  <div class="field">
    <%= form.label :entry_date, class: "label" %>
    <div class="control">
      <%= form.date_field :entry_date, class: "input", value: (@diary_entry.entry_date || Date.current) %>
    </div>
    <p class="help has-text-info">Select the date for your diary entry</p>
  </div>

  <div class="field">
    <%= form.label :content, "Diary Entry Content", class: "label" %>
    <div class="control">
      <%= form.rich_text_area :content, class: "rich-text-area", data: { behavior: "content-placeholder" } %>
    </div>
    <p class="help">Write your diary entry here...</p>
  </div>

  <!-- Existing Images Display -->
  <% if @diary_entry.persisted? && @diary_entry.images.attached? %>
    <div class="field">
      <label class="label">Current Photos</label>
      <div class="columns is-multiline is-mobile">
        <% @diary_entry.images.each_with_index do |image, index| %>
          <div class="column is-one-quarter-desktop is-one-third-tablet is-half-mobile">
            <div class="card">
              <div class="card-image">
                <figure class="image is-square">
                  <%= image_tag url_for(image), 
                      alt: "Photo #{index + 1}",
                      style: "width: 100%; height: 150px; object-fit: cover;" %>
                </figure>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      <p class="help has-text-info">Current photos attached to this entry. Upload new photos below to add more.</p>
    </div>
  <% end %>

  <!-- Image Upload Field -->
  <div class="field">
    <%= form.label :images, "Upload Photos", class: "label" %>
    <div class="control">
      <%= form.file_field :images, multiple: true, accept: "image/*", 
          class: "file-input", id: "image-upload" %>
      <label for="image-upload" class="file-label">
        <span class="file-cta">
          <span class="file-icon">
            <i class="fas fa-upload"></i>
          </span>
          <span class="file-label">
            Choose photosâ€¦
          </span>
        </span>
      </label>
    </div>
    <p class="help">Select one or more photos to add to your diary entry (JPG, PNG, GIF)</p>
  </div>



  <div class="field">
    <div class="control">
      <%= form.submit class: "button is-primary" %>
    </div>
  </div>
<% end %>

<script>
// Simple date picker enhancement
document.addEventListener('DOMContentLoaded', function() {
  const dateInput = document.getElementById('diary_entry_entry_date');
  if (dateInput && !dateInput.value) {
    // Set today's date as default if no date is set
    const today = new Date().toISOString().split('T')[0];
    dateInput.value = today;
  }
});
</script>





